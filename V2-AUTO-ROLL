-- [[ SETTINGS & LIST ]]
local diceList = {
    "Normal Dice", "Gold Dice", "Glass Dice", "Emerald Dice", "Diamond Dice", "Ocean Dice", 
    "Lava Dice", "Sapphire Dice", "Ruby Dice", "Obsidian Dice", "Evil Dice", 
    "Futuristic Dice", "Angel Dice", "Chromatic Dice", "Ancient Dice", 
    "Godly Dice", "Universal Dice", "Transcendent Dice", "Blackhole Dice", "Infinity Dice"
}

local Toggles = {}
local UIS = game:GetService("UserInputService")
local Players = game:GetService("Players")

-- Find PlayerGui without using WaitForChild (prevents freezing)
local LP = Players.LocalPlayer
local PGui = LP:FindFirstChildOfClass("PlayerGui") or LP:FindFirstChild("PlayerGui")

-- [[ UI SETUP ]]
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "DiceAutoRoll_Fixed"
ScreenGui.IgnoreGuiInset = true
ScreenGui.ResetOnSpawn = false
ScreenGui.DisplayOrder = 999
ScreenGui.Parent = PGui

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 240, 0, 360)
MainFrame.Position = UDim2.new(0.5, -120, 0.5, -180)
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true 
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 8)
MainCorner.Parent = MainFrame

-- [[ HEADER / MOVEABLE HANDLE ]]
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 40)
Title.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Title.Text = "  [[ SETTINGS & LIST ]]"
Title.TextColor3 = Color3.fromRGB(255, 60, 60)
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Font = Enum.Font.GothamBold
Title.TextSize = 14
Title.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 8)
TitleCorner.Parent = Title

local Scroll = Instance.new("ScrollingFrame")
Scroll.Size = UDim2.new(1, -10, 1, -50)
Scroll.Position = UDim2.new(0, 5, 0, 45)
Scroll.BackgroundTransparency = 1
Scroll.BorderSizePixel = 0
Scroll.CanvasSize = UDim2.new(0, 0, 0, #diceList * 36)
Scroll.ScrollBarThickness = 2
Scroll.ScrollBarImageColor3 = Color3.fromRGB(255, 60, 60)
Scroll.Parent = MainFrame

local ListLayout = Instance.new("UIListLayout")
ListLayout.Parent = Scroll
ListLayout.Padding = UDim.new(0, 5)

-- [[ GENERATE LIST ]]
for _, diceName in ipairs(diceList) do
    Toggles[diceName] = false

    local Item = Instance.new("Frame")
    Item.Size = UDim2.new(1, -5, 0, 32)
    Item.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    Item.Parent = Scroll
    Instance.new("UICorner", Item).CornerRadius = UDim.new(0, 4)

    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(0.7, 0, 1, 0)
    Label.Position = UDim2.new(0.05, 0, 0, 0)
    Label.Text = diceName
    Label.TextColor3 = Color3.fromRGB(255, 255, 255)
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Font = Enum.Font.Gotham
    Label.TextSize = 12
    Label.BackgroundTransparency = 1
    Label.Parent = Item

    local Checkbox = Instance.new("TextButton")
    Checkbox.Size = UDim2.new(0, 45, 0, 22)
    Checkbox.Position = UDim2.new(0.95, -45, 0.5, -11)
    Checkbox.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    Checkbox.Text = "OFF"
    Checkbox.TextColor3 = Color3.new(1, 1, 1)
    Checkbox.Font = Enum.Font.GothamBold
    Checkbox.TextSize = 10
    Checkbox.Parent = Item
    Instance.new("UICorner", Checkbox).CornerRadius = UDim.new(0, 4)

    Checkbox.MouseButton1Click:Connect(function()
        Toggles[diceName] = not Toggles[diceName]
        Checkbox.Text = Toggles[diceName] and "ON" or "OFF"
        Checkbox.BackgroundColor3 = Toggles[diceName] and Color3.fromRGB(255, 60, 60) or Color3.fromRGB(50, 50, 50)
    end)
end

-- [[ DRAGGING SYSTEM (MOVEABLE) ]]
local dragging, dragStart, startPos
Title.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
    end
end)

UIS.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

UIS.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

-- [[ BACKGROUND AUTO-ROLL LOGIC ]]
task.spawn(function()
    local RS = game:GetService("ReplicatedStorage")
    local remote = nil
    
    -- This part waits in the background so the UI still shows up immediately
    while not remote do
        local func = RS:FindFirstChild("Functions")
        if func then
            remote = func:FindFirstChild("DiceClientToServer")
        end
        task.wait(1)
    end

    while true do
        for dice, active in pairs(Toggles) do
            if active then
                pcall(function() remote:InvokeServer(dice) end)
                task.wait(0.09)
            end
        end
        task.wait(0.01)
    end
end)

warn("Dice UI Force-Injected Successfully.")
