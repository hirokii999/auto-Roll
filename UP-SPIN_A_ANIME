-- [[ SETTINGS & LIST ]]
local diceList = {
    "Normal Dice", "Gold Dice", "Glass Dice", "Emerald Dice", "Diamond Dice", "Ocean Dice", 
    "Lava Dice", "Sapphire Dice", "Ruby Dice", "Obsidian Dice", "Evil Dice", 
    "Futuristic Dice", "Angel Dice", "Chromatic Dice", "Ancient Dice", 
    "Godly Dice", "Universal Dice", "Transcendent Dice", "Blackhole Dice", "Infinity Dice"
}

-- Separate Toggle Tables
local RollToggles = {}
local BuyToggles = {}

local UIS = game:GetService("UserInputService")
local Players = game:GetService("Players")
local RS = game:GetService("ReplicatedStorage")

-- [[ PLAYER & UI CLEANUP ]]
local LP = Players.LocalPlayer
local PGui = LP:FindFirstChildOfClass("PlayerGui") or LP:FindFirstChild("PlayerGui")

if PGui:FindFirstChild("DiceManager_V2") then
    PGui["DiceManager_V2"]:Destroy()
end

-- [[ UI SETUP ]]
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "DiceManager_V2"
ScreenGui.ResetOnSpawn = false
ScreenGui.DisplayOrder = 999
ScreenGui.Parent = PGui

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 320, 0, 400) -- Widened for two columns
MainFrame.Position = UDim2.new(0.5, -160, 0.5, -200)
MainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true 
MainFrame.Parent = ScreenGui

Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 8)

-- [[ HEADER ]]
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 40)
Title.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Title.Text = "  DICE MANAGER (ROLL | BUY)"
Title.TextColor3 = Color3.fromRGB(255, 60, 60)
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Font = Enum.Font.GothamBold
Title.TextSize = 14
Title.Parent = MainFrame

Instance.new("UICorner", Title).CornerRadius = UDim.new(0, 8)

-- [[ LIST HEADERS ]]
local RollHeader = Instance.new("TextLabel")
RollHeader.Size = UDim2.new(0, 40, 0, 20)
RollHeader.Position = UDim2.new(0.68, 0, 0, 45)
RollHeader.Text = "ROLL"
RollHeader.TextColor3 = Color3.fromRGB(150, 150, 150)
RollHeader.Font = Enum.Font.GothamBold
RollHeader.TextSize = 10
RollHeader.BackgroundTransparency = 1
RollHeader.Parent = MainFrame

local BuyHeader = Instance.new("TextLabel")
BuyHeader.Size = UDim2.new(0, 40, 0, 20)
BuyHeader.Position = UDim2.new(0.85, 0, 0, 45)
BuyHeader.Text = "BUY"
BuyHeader.TextColor3 = Color3.fromRGB(150, 150, 150)
BuyHeader.Font = Enum.Font.GothamBold
BuyHeader.TextSize = 10
BuyHeader.BackgroundTransparency = 1
BuyHeader.Parent = MainFrame

local Scroll = Instance.new("ScrollingFrame")
Scroll.Size = UDim2.new(1, -10, 1, -75)
Scroll.Position = UDim2.new(0, 5, 0, 70)
Scroll.BackgroundTransparency = 1
Scroll.BorderSizePixel = 0
Scroll.CanvasSize = UDim2.new(0, 0, 0, #diceList * 38)
Scroll.ScrollBarThickness = 2
Scroll.Parent = MainFrame

local ListLayout = Instance.new("UIListLayout")
ListLayout.Parent = Scroll
ListLayout.Padding = UDim.new(0, 5)

-- [[ GENERATE LIST ]]
for _, diceName in ipairs(diceList) do
    RollToggles[diceName] = false
    BuyToggles[diceName] = false

    local Item = Instance.new("Frame")
    Item.Size = UDim2.new(1, -5, 0, 32)
    Item.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    Item.Parent = Scroll
    Instance.new("UICorner", Item).CornerRadius = UDim.new(0, 4)

    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(0.5, 0, 1, 0)
    Label.Position = UDim2.new(0.05, 0, 0, 0)
    Label.Text = diceName
    Label.TextColor3 = Color3.fromRGB(255, 255, 255)
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Font = Enum.Font.Gotham
    Label.TextSize = 11
    Label.BackgroundTransparency = 1
    Label.Parent = Item

    -- ROLL BUTTON
    local RollBtn = Instance.new("TextButton")
    RollBtn.Size = UDim2.new(0, 40, 0, 22)
    RollBtn.Position = UDim2.new(0.7, -5, 0.5, -11)
    RollBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    RollBtn.Text = "OFF"
    RollBtn.TextColor3 = Color3.new(1, 1, 1)
    RollBtn.Font = Enum.Font.GothamBold
    RollBtn.TextSize = 9
    RollBtn.Parent = Item
    Instance.new("UICorner", RollBtn).CornerRadius = UDim.new(0, 4)

    RollBtn.MouseButton1Click:Connect(function()
        RollToggles[diceName] = not RollToggles[diceName]
        RollBtn.Text = RollToggles[diceName] and "ON" or "OFF"
        RollBtn.BackgroundColor3 = RollToggles[diceName] and Color3.fromRGB(255, 60, 60) or Color3.fromRGB(50, 50, 50)
    end)

    -- BUY BUTTON
    local BuyBtn = Instance.new("TextButton")
    BuyBtn.Size = UDim2.new(0, 40, 0, 22)
    BuyBtn.Position = UDim2.new(0.88, -5, 0.5, -11)
    BuyBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    BuyBtn.Text = "OFF"
    BuyBtn.TextColor3 = Color3.new(1, 1, 1)
    BuyBtn.Font = Enum.Font.GothamBold
    BuyBtn.TextSize = 9
    BuyBtn.Parent = Item
    Instance.new("UICorner", BuyBtn).CornerRadius = UDim.new(0, 4)

    BuyBtn.MouseButton1Click:Connect(function()
        BuyToggles[diceName] = not BuyToggles[diceName]
        BuyBtn.Text = BuyToggles[diceName] and "ON" or "OFF"
        BuyBtn.BackgroundColor3 = BuyToggles[diceName] and Color3.fromRGB(60, 255, 60) or Color3.fromRGB(50, 50, 50)
    end)
end

-- [[ DRAGGING SYSTEM ]]
local dragging, dragStart, startPos
Title.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
    end
end)
UIS.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)
UIS.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
end)

-- [[ SEPARATED BACKGROUND LOGIC ]]
local Functions = RS:WaitForChild("Functions", 10)
local RollRemote = Functions:WaitForChild("DiceClientToServer", 5)
local BuyRemote = Functions:WaitForChild("BuyDice", 5)

-- Loop 1: Auto Roll (Faster)
task.spawn(function()
    while true do
        for dice, active in pairs(RollToggles) do
            if active then
                pcall(function() RollRemote:InvokeServer(dice) end)
                task.wait(0.05)
            end
        end
        task.wait(0.1)
    end
end)

-- Loop 2: Auto Buy (Slower cycle)
task.spawn(function()
    while true do
        for dice, active in pairs(BuyToggles) do
            if active then
                pcall(function() BuyRemote:InvokeServer(dice, 2) end)
                task.wait(0.3) -- Matches your original waitTime
            end
        end
        task.wait(5) -- Matches your original cycleDelay
    end
end)

warn("Dice Manager V2: Separate Roll & Buy Active.")
