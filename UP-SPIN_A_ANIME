-- [[ SETTINGS & LIST ]]
local diceList = {
    "Normal Dice", "Gold Dice", "Glass Dice", "Emerald Dice", "Diamond Dice", "Ocean Dice", 
    "Lava Dice", "Sapphire Dice", "Ruby Dice", "Obsidian Dice", "Evil Dice", 
    "Futuristic Dice", "Angel Dice", "Chromatic Dice", "Ancient Dice", 
    "Godly Dice", "Universal Dice", "Transcendent Dice", "Blackhole Dice", "Infinity Dice"
}

local RollToggles, BuyToggles = {}, {}
local AutoEquipEnabled = false

local UIS = game:GetService("UserInputService")
local Players = game:GetService("Players")
local RS = game:GetService("ReplicatedStorage")

local LP = Players.LocalPlayer
local PGui = LP:FindFirstChildOfClass("PlayerGui") or LP:FindFirstChild("PlayerGui")

if PGui:FindFirstChild("DiceManager_V4") then PGui["DiceManager_V4"]:Destroy() end

-- [[ UI SETUP ]]
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "DiceManager_V4"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = PGui

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 320, 0, 440)
MainFrame.Position = UDim2.new(0.5, -160, 0.5, -220)
MainFrame.BackgroundColor3 = Color3.fromRGB(12, 12, 12)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true 
MainFrame.Parent = ScreenGui
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 8)

-- [[ HEADER ]]
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 40)
Title.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Title.Text = "  DICE MANAGER V4 [TURBO]"
Title.TextColor3 = Color3.fromRGB(255, 60, 60)
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Font = Enum.Font.GothamBold
Title.TextSize = 14
Title.Parent = MainFrame
Instance.new("UICorner", Title).CornerRadius = UDim.new(0, 8)

-- [[ AUTO EQUIP BUTTON ]]
local EquipBtn = Instance.new("TextButton")
EquipBtn.Size = UDim2.new(1, -20, 0, 30)
EquipBtn.Position = UDim2.new(0, 10, 0, 50)
EquipBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
EquipBtn.Text = "AUTO EQUIP BEST: OFF"
EquipBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
EquipBtn.Font = Enum.Font.GothamBold
EquipBtn.TextSize = 12
EquipBtn.Parent = MainFrame
Instance.new("UICorner", EquipBtn).CornerRadius = UDim.new(0, 4)

EquipBtn.MouseButton1Click:Connect(function()
    AutoEquipEnabled = not AutoEquipEnabled
    EquipBtn.Text = "AUTO EQUIP BEST: " .. (AutoEquipEnabled and "ON" or "OFF")
    EquipBtn.BackgroundColor3 = AutoEquipEnabled and Color3.fromRGB(0, 120, 255) or Color3.fromRGB(30, 30, 30)
end)

-- [[ LIST ]]
local Scroll = Instance.new("ScrollingFrame")
Scroll.Size = UDim2.new(1, -10, 1, -110)
Scroll.Position = UDim2.new(0, 5, 0, 100)
Scroll.BackgroundTransparency = 1
Scroll.CanvasSize = UDim2.new(0, 0, 0, #diceList * 36)
Scroll.ScrollBarThickness = 2
Scroll.Parent = MainFrame

local ListLayout = Instance.new("UIListLayout")
ListLayout.Parent = Scroll
ListLayout.Padding = UDim.new(0, 4)

for _, diceName in ipairs(diceList) do
    RollToggles[diceName] = false
    BuyToggles[diceName] = false

    local Item = Instance.new("Frame")
    Item.Size = UDim2.new(1, -5, 0, 32)
    Item.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    Item.Parent = Scroll
    Instance.new("UICorner", Item).CornerRadius = UDim.new(0, 4)

    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(0.5, 0, 1, 0)
    Label.Position = UDim2.new(0.05, 0, 0, 0)
    Label.Text = diceName
    Label.TextColor3 = Color3.fromRGB(255, 255, 255)
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Font = Enum.Font.Gotham
    Label.TextSize = 11
    Label.BackgroundTransparency = 1
    Label.Parent = Item

    local function CreateToggle(pos, txt, color, tbl)
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(0, 40, 0, 22)
        btn.Position = UDim2.new(pos, -5, 0.5, -11)
        btn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
        btn.Text = txt
        btn.TextColor3 = Color3.new(1, 1, 1)
        btn.Font = Enum.Font.GothamBold
        btn.TextSize = 8
        btn.Parent = Item
        Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 4)
        btn.MouseButton1Click:Connect(function()
            tbl[diceName] = not tbl[diceName]
            btn.BackgroundColor3 = tbl[diceName] and color or Color3.fromRGB(45, 45, 45)
        end)
    end

    CreateToggle(0.7, "ROLL", Color3.fromRGB(255, 60, 60), RollToggles)
    CreateToggle(0.88, "BUY", Color3.fromRGB(60, 255, 60), BuyToggles)
end

-- [[ TURBO LOGIC ]]
local Functions = RS:WaitForChild("Functions", 10)
local Events = RS:WaitForChild("Events", 10)
local RollRemote = Functions:WaitForChild("DiceClientToServer", 5)
local BuyRemote = Functions:WaitForChild("BuyDice", 5)
local EquipRemote = Events:WaitForChild("EquipBestCharacters", 5)

-- Turbo Roll Loop (Maximum Speed)
task.spawn(function()
    while true do
        local start = os.clock()
        for dice, active in pairs(RollToggles) do
            if active then 
                task.spawn(function() pcall(function() RollRemote:InvokeServer(dice) end) end)
            end
        end
        -- Dynamic wait to prevent frame drops
        task.wait(0.03) 
    end
end)

-- Turbo Buy Loop
task.spawn(function()
    while true do
        for dice, active in pairs(BuyToggles) do
            if active then 
                task.spawn(function() pcall(function() BuyRemote:InvokeServer(dice, 2) end) end)
            end
        end
        task.wait(2) -- Reduced cycle delay from 5s to 2s
    end
end)

-- Auto Equip Loop (Every 5 seconds instead of 10)
task.spawn(function()
    while true do
        if AutoEquipEnabled then pcall(function() EquipRemote:FireServer() end) end
        task.wait(5)
    end
end)

-- Draggable logic
local d,ds,sp; Title.InputBegan:Connect(function(i) if i.UserInputType==Enum.UserInputType.MouseButton1 then d=true ds=i.Position sp=MainFrame.Position end end)
UIS.InputChanged:Connect(function(i) if d and i.UserInputType==Enum.UserInputType.MouseMovement then local delta=i.Position-ds MainFrame.Position=UDim2.new(sp.X.Scale,sp.X.Offset+delta.X,sp.Y.Scale,sp.Y.Offset+delta.Y) end end)
UIS.InputEnded:Connect(function(i) if i.UserInputType==Enum.UserInputType.MouseButton1 then d=false end end)

warn("Dice Manager V4: Speed Optimized.")
